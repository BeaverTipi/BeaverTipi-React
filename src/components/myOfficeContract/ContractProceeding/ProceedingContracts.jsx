import React, { useEffect, useState } from 'react'
import { useSecureAxios } from '../../../hooks/useSecureAxios';

function ProceedingContracts() {
  const [] = useState();
  const [] = useState();
  const [] = useState();
  const [] = useState();
  const [] = useState();
  const [] = useState();
  const [] = useState();
  useEffect(() => { }, []);
  useEffect(() => { }, []);
  useEffect(() => { }, []);
  const axios = useSecureAxios();

  const [procContracts, setProcContracts] = useState();
  useEffect(() => {
    axios.post("cont/proc/list")
      .then(data => {
        console.log("proceeding-contracts:: ", data);
        setProcContracts(data);
      });
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);



  return (
    <>
      <ComponentCard
        title="üìù ÏßÑÌñâÏ§ëÏù∏ Í≥ÑÏïΩ"
      >
        {/* Í≤ÄÏÉâÏöîÏÜå */}
        <div className="mb-2 p-3 pb-1 border rounded-xl bg-gray-50">
          <div data-name={"SearchBox^0^"} className="flex flex-row justify-between">
            <div className="flex flex-row gap-3">
              <div className="flex flex-col justify-start">
                <Label className="h-fit text-xs font-semibold">Ôºä Îß§Î¨º Ïú†Ìòï</Label>
                <SelectControlled
                  value={filterListingTypeValue}
                  onChange={(val) => setFilterListingTypeValue(val)}
                  options={listingTypeOptions}
                  placeholder="--Îß§Î¨ºÏú†Ìòï ÏÑ†ÌÉù--"
                  className="max-h-9 text-xs w-[90px]"
                />
              </div>
              <div className="flex flex-col justify-start">
                <Label className="h-fit text-xs font-semibold">Ôºä Í±∞Îûò Ïú†Ìòï</Label>
                <SelectControlled
                  value={filterTypeSaleValue}
                  onChange={(val) => setFilterTypeSaleValue(val)}
                  options={typeSaleOptions}
                  placeholder="--Í±∞ÎûòÏú†Ìòï ÏÑ†ÌÉù--"
                  className="max-h-9 text-xs w-[90px]"
                />
              </div>

              <div className="flex flex-col justify-start">
                <Label className="h-fit text-xs font-semibold">Ôºä Í±∞Îûò ÏÉÅÌÉú</Label>
                <SelectControlled
                  value={filterProdStatValue}
                  onChange={(val) => setFilterProdStatValue(val)}
                  options={prodStatOptions}
                  placeholder="--Í±∞ÎûòÏÉÅÌÉú ÏÑ†ÌÉù--"
                  className="max-h-9 text-xs w-[90px]"
                />
              </div>
              <div className="flex flex-col-reverse justify-start mb-3">
                <button
                  onClick={handleResetFilters}
                  className="w-[70px] text-xs text-amber-800 border border-amber-800 rounded px-3 py-1 hover:text-amber-600 hover:border-amber-500 hover:bg-amber-50 dark:hover:bg-gray-800"
                >
                  Ï¥àÍ∏∞Ìôî
                </button>
              </div>
            </div>
            <div className="flex flex-row gap-0 items-center mb-2">
              <div className="flex flex-col justify-start h-fit">
                <Label className="h-fit text-xs font-semibold">Ôºä Í≤ÄÏÉâ Ï°∞Í±¥</Label>
                <SelectControlled
                  value={searchCategory}
                  onChange={(val) => setSearchCategory(val)}
                  placeholder="--ÏÑ†ÌÉù--"
                  options={[
                    { label: "Ï†ÑÏ≤¥Í≤ÄÏÉâ", value: "Ï†ÑÏ≤¥" },
                    { label: "Îß§Î¨ºÎ™Ö", value: "Îß§Î¨ºÎ™Ö" },
                    { label: "ÏûÑÎåÄÏù∏", value: "ÏûÑÎåÄÏù∏" },
                    { label: "Ï£ºÏÜå", value: "Ï£ºÏÜå" },
                  ]}
                  className="mr-2 max-h-9 text-xs w-[90px]"
                />
              </div>
              <div className="flex flex-col justify-start h-fit">
                <Label className="h-fit text-xs font-semibold invisible">.</Label>
                <Input
                  type="text"
                  placeholder="Í≤ÄÏÉâÏñ¥ ÏûÖÎ†•"
                  value={searchText}
                  onChange={(e) => {
                    setSearchText(e.target.value);
                    setCurrentPage(1);
                    if (e.target.value.trim() === "") {
                      setBackspaceUsed(true);
                    } else {
                      setBackspaceUsed(false);
                    }
                  }}
                  onKeyDown={(e) => {
                    if (e.key === "Backspace") setBackspaceUsed(true);
                  }}
                  className="ml-0 w-[200px] max-h-9 text-xs"
                />
              </div>
            </div>
          </div>
        </div>
        <div className="overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-white/[0.05] dark:bg-white/[0.03]">
          <div className="max-w-full overflow-x-auto">
            <Table>
              {/* Table Header */}
              <TableHeader className="border-b border-gray-100 dark:border-white/[0.05]">
                <TableRow>
                  <TableCell
                    isHeader
                    className="w-[70px] px-5 py-3 font-medium text-gray-500 text-center text-theme-xs dark:text-gray-400"
                  >
                    Î≤àÌò∏
                  </TableCell>
                  <TableCell
                    isHeader
                    className="w-[100px] px-5 py-3 font-medium text-gray-500 text-center text-theme-xs dark:text-gray-400"
                  >
                    Ïú†Ìòï
                  </TableCell>
                  <TableCell
                    isHeader
                    className="w-[350px] px-5 py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400"
                  >
                    Îß§Î¨ºÎ™Ö
                  </TableCell>
                  <TableCell
                    isHeader
                    className="w-[80px] px-5 py-3 font-medium text-gray-500 text-center text-theme-xs dark:text-gray-400"
                  >
                    ÏûÑÎåÄÏù∏
                  </TableCell>
                  <TableCell
                    isHeader
                    className="w-[120px] px-5 py-3 font-medium text-gray-500 text-center text-theme-xs dark:text-gray-400"
                  >
                    Í±∞ÎûòÏú†Ìòï
                  </TableCell>
                  <TableCell
                    isHeader
                    className="w-[120px] px-5 py-3 font-medium text-gray-500 text-center text-theme-xs dark:text-gray-400"
                  >
                    Í±∞ÎûòÏÉÅÌÉú
                  </TableCell>
                  <TableCell
                    isHeader
                    className="w-[200px] px-5 py-3 font-medium text-gray-500 text-center text-theme-xs dark:text-gray-400"
                  >
                    ÎπÑÍ≥†
                  </TableCell>
                </TableRow>
              </TableHeader>

              {/* Table Body */}
              <TableBody className="divide-y divide-gray-100 dark:divide-white/[0.05]">
                {paginatedList.map((lstg, idx) => (
                  <TableRow
                    key={lstg.lstgId}
                    className={"hover:bg-gray-100 dark:hover:bg-white/5"}
                  >
                    <TableCell className="px-5 py-4 sm:px-6 text-center">
                      <div className="pointer-events-none flex justify-center items-center gap-3 overflow-hidden text-ellipsis whitespace-nowrap">
                        <span className="block text-gray-500 text-theme-xs dark:text-gray-400">
                          {idx + 1}
                        </span>
                      </div>
                    </TableCell>
                    <TableCell className="px-4 py-3 text-gray-500 text-center text-theme-sm dark:text-gray-400">
                      <div className="pointer-events-none overflow-hidden text-ellipsis whitespace-nowrap">
                        {getListingTypeCode1Name(lstg.lstgTypeCode1)}
                      </div>
                    </TableCell>
                    <TableCell className="px-4 py-3 text-gray-500 text-start text-theme-sm dark:text-gray-400">
                      <div
                        title={lstg.lstgNm}
                        className="cursor-pointer text-gray-500 hover:underline flex -space-x-2 overflow-hidden text-ellipsis whitespace-nowrap"
                        onClick={() => {
                          console.log("üì£ Row clicked!", lstg.lstgId);
                          handleSelectListing(lstg.lstgId);
                        }}
                      >
                        {lstg.lstgNm}
                      </div>
                    </TableCell>
                    <TableCell className="px-4 py-3 text-gray-500 text-start text-theme-sm dark:text-gray-400">
                      <div className="pointer-events-none flex justify-center -space-x-2 text-center overflow-hidden text-ellipsis whitespace-nowrap">
                        {lstg.tenancyInfo !== null
                          ? lstg.tenancyInfo.mbrNm
                          : "-"}
                      </div>
                    </TableCell>
                    <TableCell className="px-4 py-3 text-gray-500 text-theme-sm text-center dark:text-gray-400">
                      <div className="pointer-events-none overflow-hidden text-ellipsis whitespace-nowrap">
                        ^0^
                      </div>
                    </TableCell>
                    <TableCell className="px-4 py-3 text-gray-500 text-center text-theme-sm dark:text-gray-400">
                      <div className="pointer-events-none overflow-hidden text-ellipsis whitespace-nowrap">
                        {getListingProdStatName(lstg.lstgProdStat)}
                      </div>
                    </TableCell>
                    <TableCell className="px-4 py-3 text-gray-500 text-center text-theme-sm dark:text-gray-400">
                      <div className="pointer-events-none overflow-hidden text-ellipsis whitespace-nowrap"></div>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>

          </div>
        </div>
        <div>
          <div className="flex flex-row justify-center -space-x-2 gap-3 max-w-full overflow-x-auto">
            {Array.from({ length: totalPages }, (_, i) => (
              <button
                key={i}
                className={`px-3 py-1 rounded ${i + 1 === currentPage ? 'bg-amber-600 border border-amber-400 text-white' : 'bg-gray-100 border border-gray-300 text-gray-400'}`}
                onClick={() => setCurrentPage(i + 1)}
              >
                {i + 1}
              </button>
            ))}
          </div>
        </div>
      </ComponentCard>

      <Modal
        isOpen={isModalOpen}
        onClose={() => setModalOpen(false)}
        className="max-w-2xl p-4"
      >
        <ComponentCard
          title={selectedListing?.lstgNm || "ÏÑ†ÌÉùÎêú Îß§Î¨º"}
          desc={`${selectedListing?.lstgAdd || ""} ${selectedListing?.lstgAdd2 || ""
            }`}
        >
          <div className="p-6 space-y-6">
            <div className="flex items-start justify-between">
              <div>
                <h2 className="text-xl font-semibold text-gray-800 dark:text-white">
                  {selectedListing?.lstgNm}
                </h2>
                <p className="text-sm text-gray-500 dark:text-gray-300">
                  {selectedListing?.lstgAdd} {selectedListing?.lstgAdd2}
                </p>
              </div>
              {getListingProdStatName(selectedListing?.lstgProdStat)}
            </div>

            {/* Ïù¥ÎØ∏ÏßÄ */}
            {selectedListing?.thumbnailUrl && (
              <div className="w-full overflow-hidden rounded-lg">
                <ResponsiveImage
                  src={selectedListing.thumbnailUrl}
                  alt="Îß§Î¨º Ïù¥ÎØ∏ÏßÄ"
                />
              </div>
            )}

            {/* ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Í∑∏Î¶¨Îìú */}
            <div className="grid grid-cols-2 gap-4 text-sm text-gray-700 dark:text-gray-200">
              <div>
                <span className="font-medium text-gray-600 dark:text-gray-300">
                  Ï†ÑÏö©Î©¥Ï†Å
                </span>
                <br />
                {selectedListing?.lstgExArea}„é°
              </div>
              <div>
                <span className="font-medium text-gray-600 dark:text-gray-300">
                  Í≥µÍ∏âÎ©¥Ï†Å
                </span>
                <br />
                {selectedListing?.lstgGrArea}„é°
              </div>
              <div>
                <span className="font-medium text-gray-600 dark:text-gray-300">
                  ÏûÑÎåÄÏù∏
                </span>
                <br />
                {selectedListing?.tenancyInfo?.mbrNm || "Ï†ïÎ≥¥ ÏóÜÏùå"}
              </div>
              <div>
                <span className="font-medium text-gray-600 dark:text-gray-300">
                  Î∞© Î≤àÌò∏
                </span>
                <br />
                {selectedListing?.lstgRoomNum || "-"}
              </div>
            </div>

            {/* ÏÉÅÏÑ∏ ÏÑ§Î™Ö */}
            <div className="pt-4 border-t border-gray-100 dark:border-white/10">
              <h3 className="font-medium text-gray-800 dark:text-white mb-1">
                ÏÉÅÏÑ∏ ÏÑ§Î™Ö
              </h3>
              <p className="text-sm text-gray-600 dark:text-gray-300 whitespace-pre-line">
                {selectedListing?.lstgDst || "ÏÑ§Î™Ö ÏóÜÏùå"}
              </p>
            </div>

            {/* Î≤ÑÌäº */}
            <div className="flex justify-end pt-4 gap-3">
              {/* ÏûÑÎåÄÏù∏ Ï†ïÎ≥¥ ÏûÖÎ†• Î≤ÑÌäº (tenancyInfoÍ∞Ä ÏóÜÏùÑ ÎïåÎßå ÎÖ∏Ï∂ú) */}
              {!selectedListing?.tenancyInfo && (
                <Button
                  onClick={handleGoToContract}
                  className="ml-2 text-sm text-white bg-amber-600 hover:bg-amber-800"
                >
                  ÏûÑÎåÄÏù∏ Ï†ïÎ≥¥ ÏûÖÎ†•
                </Button>
              )}
              <Button
                color="gray"
                onClick={() => setModalOpen(false)}
                className="bg-gray-300 text-gray-700 hover:text-gray-200 hover:bg-gray-700 dark:bg-gray-800 dark:hover:bg-gray-700 dark:text-white"
              >
                Îã´Í∏∞
              </Button>
              <Button
                color="primary"
                onClick={handleGoToContract}
                disabled={!selectedListing?.tenancyInfo}
                className={`px-6 text-white 
                ${selectedListing?.tenancyInfo
                    ? "bg-amber-600 hover:bg-amber-800"
                    : "bg-gray-300 cursor-not-allowed"
                  }`}
              >
                Í≥ÑÏïΩÏúºÎ°ú Ïù¥Îèô
              </Button>
            </div>
          </div>
        </ComponentCard>
      </Modal>
    </>
  )
}

export default ProceedingContracts